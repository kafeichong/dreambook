硬件配置（非常强大！）

  - ✅ CPU: 128核心（使用率仅 2%）- 资源非常充足
  - ✅ 内存: 1007.5GB（使用 97.7GB，10%）- 内存超级富余
  - ✅ 系统: Ubuntu 22（稳定版）
  - ✅ 管理面板: 1Panel（Docker 管理）

  磁盘配置

  - / - 629.9GB/786.4GB (84% ⚠️) - 系统盘有点紧张
  - /data - 1.5TB/6.9TB (23%) - 还有很多空间
  - /mnt/d1 - 125.2GB/18.1TB (0%) - 几乎空的
  - /mnt/d5 - 4.5TB/18.1TB (25%) - 很多空间
  - /mnt/d2-d4 - 基本空的

  当前运行

  - 7个网站
  - 9个数据库
  - 负载仅 1%（运行流畅）

  ---
  🎯 最佳部署方案

  方案推荐：标准化 1Panel Docker 部署

  基于你的环境（1Panel + Docker），建议采用以下方案：

  1Panel 管理界面
     ↓
  Docker 容器编排
     ├─→ emotion-library-nginx-prod (已存在)
     │      ├─→ emotion-library 项目
     │      └─→ DreamBook 前端静态文件 (新增)
     │
     └─→ dreambook-backend (新增容器)
            └─→ DeepSeek API

  ---
  📝 详细部署步骤

  第一步：选择部署目录

  推荐使用 /data 目录（空间充足且专门用于数据）

  # SSH 登录服务器
  ssh 131****2933@your-server-ip

  # 创建项目目录
  mkdir -p /data/dreambook
  cd /data/dreambook

  第二步：上传代码

  方式A：使用 Git（推荐）
  cd /data/dreambook
  git clone <your-repo-url> .

  # 或者只上传需要的目录
  git clone <your-repo-url> temp
  mv temp/code/dreambook-api ./
  mv temp/code/dreambook-web ./
  mv temp/code/deploy ./
  rm -rf temp

  方式B：通过 1Panel 上传
  1. 在 1Panel 界面 → 文件 → 上传
  2. 上传打包好的文件到 /data/dreambook/

  方式C：SCP 上传
  # 本地执行
  cd /Users/steven/works/20251130dreambook/code
  tar -czf dreambook-deploy.tar.gz \
    dreambook-api dreambook-web deploy \
    --exclude=node_modules --exclude=dist

  scp dreambook-deploy.tar.gz 131****2933@server:/data/dreambook/

  # 服务器解压
  cd /data/dreambook
  tar -xzf dreambook-deploy.tar.gz

  第三步：通过 1Panel 创建后端容器

  在 1Panel 界面操作：

  1. 进入"容器"管理
    - 侧边栏 → 容器 → 创建容器
  2. 配置后端容器
  容器名: dreambook-backend
  镜像: 先在命令行构建（见下方）
  端口映射: 127.0.0.1:3001 → 3000
  重启策略: always

  环境变量:
  - NODE_ENV=production
  - PORT=3000
  - DEEPSEEK_API_KEY=sk_your_key_here
  - CORS_ORIGIN=https://your-domain.com
  3. 先在命令行构建镜像
  cd /data/dreambook/dreambook-api
  docker build -t dreambook-backend:latest .
  4. 在 1Panel 创建容器
    - 选择刚才构建的镜像 dreambook-backend:latest
    - 配置环境变量和端口映射
    - 启动容器

  第四步：部署前端到现有 Nginx

  找到 emotion-library-nginx-prod 容器

  # 查看现有容器
  docker ps | grep nginx

  # 构建前端
  cd /data/dreambook/dreambook-web
  npm install
  npm run build

  # 复制前端文件到 Nginx 容器
  docker cp dist emotion-library-nginx-prod:/usr/share/nginx/html/dreambook

  # 验证文件
  docker exec emotion-library-nginx-prod ls -la /usr/share/nginx/html/dreambook/

  第五步：配置 Nginx（在 1Panel 操作）

  在 1Panel 界面：

  1. 找到 Nginx 配置
    - 侧边栏 → 网站 → 找到对应网站
    - 或：容器 → emotion-library-nginx-prod → 配置
  2. 添加 DreamBook 配置

  选项A：独立域名（推荐）

  创建新文件：/etc/nginx/conf.d/dreambook.conf

  server {
      listen 80;
      server_name dream.yourdomain.com;  # 改成你的域名

      # 前端静态文件
      location / {
          root /usr/share/nginx/html/dreambook;
          index index.html;
          try_files $uri $uri/ /index.html;
          expires 1h;
      }

      # 静态资源缓存
      location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
          root /usr/share/nginx/html/dreambook;
          expires 7d;
          add_header Cache-Control "public, max-age=604800, immutable";
      }

      # API 代理到后端容器
      location /api/ {
          proxy_pass http://host.docker.internal:3001;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

          proxy_connect_timeout 10s;
          proxy_send_timeout 30s;
          proxy_read_timeout 30s;
      }

      # 健康检查
      location /health {
          proxy_pass http://host.docker.internal:3001/health;
          access_log off;
      }

      # Gzip 压缩
      gzip on;
      gzip_types text/plain text/css application/json application/javascript;
  }

  3. 重载 Nginx
  docker exec emotion-library-nginx-prod nginx -t
  docker exec emotion-library-nginx-prod nginx -s reload

  第六步：配置 DNS

  添加 A 记录：
  dream.yourdomain.com → 服务器公网IP

  第七步：配置 HTTPS（可选但推荐）

  在 1Panel 界面：
  1. 侧边栏 → 网站 → SSL
  2. 选择 Let's Encrypt 免费证书
  3. 填写域名 dream.yourdomain.com
  4. 自动申请并配置

  第八步：验证部署

  # 测试后端
  curl http://localhost:3001/health

  # 测试前端
  curl -I http://dream.yourdomain.com/

  # 测试 API
  curl -X POST http://dream.yourdomain.com/api/dream-chat \
    -H "Content-Type: application/json" \
    -d '{"question":"测试"}'

  ---
  💡 针对你服务器的优化建议

  1. 磁盘空间优化

  问题：系统盘 / 已使用 84%，有点紧张

  建议：
  # 将 Docker 数据移到 /data（空间充足）
  # 在 1Panel 设置中修改 Docker 数据目录

  # 或者将项目部署到 /data
  cd /data/dreambook  # 已经在这里了 ✅

  2. 使用 1Panel 的优势

  已有功能可以直接用：
  - ✅ 容器管理：可视化创建、启动、停止
  - ✅ 日志查看：容器 → 日志，实时查看
  - ✅ 监控：资源使用情况一目了然
  - ✅ 备份：自动备份容器和数据
  - ✅ SSL 证书：一键申请 Let's Encrypt

  3. 资源分配

  你的服务器资源超级充足，无需担心：
  - CPU：128核只用2%，可以承受大量并发
  - 内存：1TB 只用10%，完全够用
  - 建议：可以给容器分配更多资源提升性能

  ---
  📋 快速部署清单（适配你的环境）

  # === 1. 准备目录 ===
  ssh 131****2933@your-server
  mkdir -p /data/dreambook
  cd /data/dreambook

  # === 2. 上传代码 ===
  # (使用 Git 或 1Panel 上传)

  # === 3. 构建前端 ===
  cd dreambook-web
  npm install
  npm run build

  # === 4. 构建后端镜像 ===
  cd ../dreambook-api
  docker build -t dreambook-backend:latest .

  # === 5. 在 1Panel 创建后端容器 ===
  # 容器名: dreambook-backend
  # 镜像: dreambook-backend:latest
  # 端口: 127.0.0.1:3001 -> 3000
  # 环境变量: DEEPSEEK_API_KEY, CORS_ORIGIN
  # 重启策略: always

  # === 6. 部署前端 ===
  cd ../dreambook-web
  docker cp dist emotion-library-nginx-prod:/usr/share/nginx/html/dreambook

  # === 7. 配置 Nginx ===
  # 在 1Panel 添加 dreambook.conf（见上方配置）
  docker exec emotion-library-nginx-prod nginx -s reload

  # === 8. 配置 DNS ===
  # dream.yourdomain.com -> 服务器IP

  # === 9. 验证 ===
  curl http://localhost:3001/health
  curl http://dream.yourdomain.com/

  ---
  🎯 总结

  优势

  - ✅ 1Panel 可视化管理，操作简单
  - ✅ 资源超级充足，性能无忧
  - ✅ Docker 环境已就绪
  - ✅ 已有 Nginx 容器，可直接复用

  资源占用预估

  - 后端容器：~50MB 内存（你的服务器完全不在乎）
  - 前端文件：~2-3MB（可忽略）
  - 总计：对你的服务器来说微不足道

  建议

  1. ✅ 使用 /data 目录部署（空间充足）
  2. ✅ 通过 1Panel 管理容器（可视化操作）
  3. ✅ 配置 Let's Encrypt SSL（免费且自动续期）
  4. ✅ 设置容器自动重启（already done）

  需要我帮你准备具体的 1Panel 导入配置文件吗？或者有其他问题？