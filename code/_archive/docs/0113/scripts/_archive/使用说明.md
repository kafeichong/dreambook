# DreamBook Kiosk 清理脚本使用说明

## 问题说明

原始的 `cleanup-kiosk-v3.bat` 因为编码问题导致无法执行，出现"不是内部或外部命令"错误。

## 最简单的使用方法 ⭐

**直接双击 `run-cleanup-as-admin.bat`**
- 会自动以管理员身份运行 PowerShell 清理脚本
- 遇到 UAC 提示点"是"即可
- 输入 `Y` 确认清理

## 其他可用版本

### 1. cleanup-kiosk-v3-en.bat
- **英文界面批处理脚本**
- **优点：** 完全避免编码问题，兼容性最好
- **使用方法：**
  1. 右键点击文件
  2. 选择"以管理员身份运行"
  3. 输入 `Y` 确认清理

### 2. cleanup-kiosk-v3.ps1
- **PowerShell 中文界面脚本**
- **优点：** 支持中文显示，错误处理更完善，彩色输出
- **使用方法：**
  1. 使用 `run-cleanup-as-admin.bat` 运行（推荐）
  2. 或者手动以管理员身份打开 PowerShell，然后运行：
     ```powershell
     cd 到脚本所在目录
     .\cleanup-kiosk-v3.ps1
     ```

## 功能说明

两个脚本功能完全相同，都会执行以下操作：

1. **删除 kiosk 用户**
2. **禁用自动登录**
3. **删除 DreamBook 启动项**
4. **恢复系统界面配置**

## 执行后的效果

- 移除所有 Kiosk 模式配置
- 系统恢复为普通模式
- 需要重启电脑使配置生效
- 重启后正常登录 Windows 账户

## 日志文件

执行过程会生成 `cleanup-kiosk-v3.log` 日志文件，记录所有操作。

## 注意事项

1. **必须以管理员身份运行**
2. 运行前建议备份重要数据
3. 执行后必须重启电脑
4. 如遇问题，查看日志文件排查

## 故障排除

### 如果 PowerShell 脚本无法运行：
```powershell
# 临时允许脚本执行
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass

# 然后运行脚本
.\cleanup-kiosk-v3.ps1
```

### 如果批处理脚本报错：
- 使用 PowerShell 版本
- 或者手动执行每个步骤（见下方）

### 手动清理步骤（以管理员身份运行 cmd）：
```batch
# 1. 删除用户
net user kiosk /delete

# 2. 禁用自动登录
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AutoAdminLogon /t REG_SZ /d 0 /f
reg delete "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName /f
reg delete "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword /f

# 3. 删除启动项
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v DreamBook /f

# 4. 恢复界面
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoTrayItemsDisplay /f
```

## 推荐使用顺序

1. **首选：** 双击 `run-cleanup-as-admin.bat`（最简单！）
2. **备选1：** 右键 `cleanup-kiosk-v3-en.bat` → "以管理员身份运行"
3. **备选2：** 手动以管理员身份打开 PowerShell，运行 `.\cleanup-kiosk-v3.ps1`
4. **最后：** 手动执行命令（见上方）
