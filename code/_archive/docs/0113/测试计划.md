# DreamBook Kiosk 测试计划

> 完整的功能测试、集成测试和性能测试计划

---

## 📋 测试范围

| 测试类型 | 覆盖范围 | 优先级 |
|---------|---------|--------|
| 单元测试 | 虚拟键盘 Hook、管理面板逻辑 | 🟡 中 |
| 集成测试 | IPC 通信、系统命令执行 | 🔴 高 |
| 功能测试 | 三个主要功能 | 🔴 高 |
| 性能测试 | 内存、CPU、启动时间 | 🟡 中 |
| 兼容性测试 | Windows 10、触摸屏 | 🔴 高 |
| 安全测试 | 权限、API Key、进程隔离 | 🟡 中 |

---

## 🧪 功能测试用例

### 测试 1：开机自动登录

**测试编号：** TC-001
**优先级：** 🔴 高
**前置条件：**
- Windows 10 系统已配置
- kiosk 用户已创建
- 自动登录已配置

**测试步骤：**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 重启电脑 | 系统启动 |
| 2 | 等待启动完成 | 自动登录到 kiosk 账户 |
| 3 | 观察桌面 | 直接进入 dreambook 应用 |
| 4 | 检查任务栏 | 无 Windows 任务栏 |
| 5 | 检查开始菜单 | 无 Windows 开始菜单 |

**验证标准：**
- ✅ 无需输入密码
- ✅ 自动进入应用
- ✅ 无 Windows 桌面
- ✅ 启动时间 < 60 秒

**失败处理：**
- 检查注册表配置
- 查看系统日志
- 重新运行配置脚本

---

### 测试 2：虚拟键盘弹出

**测试编号：** TC-002
**优先级：** 🔴 高
**前置条件：**
- 应用已启动
- TabletInputService 已启用

**测试步骤：**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 点击搜索框 | 输入框获得焦点 |
| 2 | 等待 500ms | 虚拟键盘弹出 |
| 3 | 点击虚拟键盘按键 | 文字输入到输入框 |
| 4 | 点击其他区域 | 虚拟键盘隐藏 |
| 5 | 再次点击输入框 | 虚拟键盘再次弹出 |

**验证标准：**
- ✅ 虚拟键盘在 1 秒内弹出
- ✅ 可以输入文字
- ✅ 输入框显示输入内容
- ✅ 虚拟键盘可以隐藏

**失败处理：**
- 检查 TabletInputService 状态
- 查看应用日志中的 `[虚拟键盘]` 信息
- 手动测试 TabTip.exe

---

### 测试 3：管理面板打开

**测试编号：** TC-003
**优先级：** 🔴 高
**前置条件：**
- 应用已启动

**测试步骤：**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 在右上角快速点击 1 次 | 计数器 = 1 |
| 2 | 在右上角快速点击 2 次 | 计数器 = 2 |
| 3 | 在右上角快速点击 3 次 | 计数器 = 3 |
| 4 | 在右上角快速点击 4 次 | 计数器 = 4 |
| 5 | 在右上角快速点击 5 次 | 管理面板弹出 |
| 6 | 等待 2 秒后点击 | 计数器重置 |

**验证标准：**
- ✅ 2 秒内点击 5 次打开面板
- ✅ 超过 2 秒重置计数
- ✅ 管理面板显示 4 个按钮
- ✅ 可以关闭面板

**失败处理：**
- 打开 DevTools 查看 `[AdminTrigger]` 日志
- 取消注释调试代码查看触发区域
- 检查 zIndex 是否被覆盖

---

### 测试 4：切换用户功能

**测试编号：** TC-004
**优先级：** 🔴 高
**前置条件：**
- 应用已启动
- 管理面板已打开

**测试步骤：**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 点击"切换用户"按钮 | 确认对话框弹出 |
| 2 | 点击"确定" | 应用退出 |
| 3 | 等待 2 秒 | 显示 Windows 登录界面 |
| 4 | 输入 Administrator 用户名 | 用户名输入框 |
| 5 | 输入密码 | 密码输入框 |
| 6 | 按 Enter 或点击登录 | 登录到 Administrator 账户 |

**验证标准：**
- ✅ 确认对话框显示
- ✅ 应用正常退出
- ✅ 显示 Windows 登录界面
- ✅ 可以登录其他账户
- ✅ 可以进行系统维护

**失败处理：**
- 检查 tsdiscon.exe 是否存在
- 查看应用日志中的 `[系统]` 信息
- 手动测试 `C:\Windows\System32\tsdiscon.exe`

---

### 测试 5：AI 解梦功能

**测试编号：** TC-005
**优先级：** 🟡 中
**前置条件：**
- 应用已启动
- 后端服务已启动
- API Key 已配置

**测试步骤：**

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 输入梦境描述 | 文字显示在输入框 |
| 2 | 点击"开始解析" | 加载动画显示 |
| 3 | 等待 5-10 秒 | AI 返回解析结果 |
| 4 | 查看结果 | 显示梦境解析内容 |
| 5 | 点击"返回" | 返回首页 |

**验证标准：**
- ✅ 输入框接受文字
- ✅ 加载动画显示
- ✅ 返回有效的解析结果
- ✅ 没有错误信息
- ✅ 可以返回首页

**失败处理：**
- 检查后端服务是否运行
- 查看 API Key 是否正确
- 检查网络连接
- 查看应用日志

---

## 📊 集成测试用例

### 测试 6：IPC 通信

**测试编号：** TC-006
**优先级：** 🔴 高

**测试场景：**

```typescript
// 1. 测试虚拟键盘 IPC
window.electronAPI.showVirtualKeyboard()
  .then(result => console.log('虚拟键盘显示:', result))
  .catch(error => console.error('虚拟键盘错误:', error))

// 2. 测试应用重启 IPC
window.electronAPI.restartApp()

// 3. 测试应用退出 IPC
window.electronAPI.exitApp()

// 4. 测试切换用户 IPC
window.electronAPI.switchUser()
```

**验证标准：**
- ✅ 所有 IPC 调用都返回 Promise
- ✅ 没有 IPC 超时
- ✅ 错误被正确处理
- ✅ 日志记录完整

---

### 测试 7：系统命令执行

**测试编号：** TC-007
**优先级：** 🔴 高

**测试场景：**

```cmd
# 1. 测试虚拟键盘启动
"C:\Program Files\Common Files\microsoft shared\ink\TabTip.exe"

# 2. 测试虚拟键盘关闭
taskkill /IM TabTip.exe /F

# 3. 测试切换用户
C:\Windows\System32\tsdiscon.exe

# 4. 测试应用重启
taskkill /IM dreambook.exe /F
C:\kiosk\dreambook\dreambook.exe
```

**验证标准：**
- ✅ 所有命令执行成功
- ✅ 没有权限错误
- ✅ 没有文件不存在错误
- ✅ 命令执行时间 < 2 秒

---

## 🚀 性能测试用例

### 测试 8：启动时间

**测试编号：** TC-008
**优先级：** 🟡 中

**测试步骤：**

```
1. 记录应用启动时间
2. 启动应用
3. 记录应用显示时间
4. 记录后端服务启动时间
5. 计算总启动时间
```

**验证标准：**
- ✅ 应用显示时间 < 5 秒
- ✅ 后端服务启动时间 < 10 秒
- ✅ 总启动时间 < 15 秒

**测试工具：**
```cmd
# 使用 Measure-Command 测量启动时间
Measure-Command { C:\kiosk\dreambook\dreambook.exe }
```

---

### 测试 9：内存使用

**测试编号：** TC-009
**优先级：** 🟡 中

**测试步骤：**

```
1. 启动应用
2. 等待 30 秒稳定
3. 记录内存使用
4. 执行 10 次虚拟键盘弹出
5. 记录内存使用
6. 执行 10 次管理面板打开
7. 记录内存使用
8. 执行 5 次 AI 解梦
9. 记录最终内存使用
```

**验证标准：**
- ✅ 空闲时内存 < 300MB
- ✅ 运行时内存 < 500MB
- ✅ 没有内存泄漏
- ✅ 内存增长 < 50MB

**测试工具：**
```cmd
# 使用任务管理器或 PowerShell
Get-Process dreambook | Select-Object WorkingSet
```

---

### 测试 10：CPU 使用

**测试编号：** TC-010
**优先级：** 🟡 中

**测试步骤：**

```
1. 启动应用
2. 等待 30 秒稳定
3. 记录 CPU 使用
4. 执行 AI 解梦
5. 记录 CPU 使用
6. 等待解梦完成
7. 记录 CPU 使用
```

**验证标准：**
- ✅ 空闲时 CPU < 5%
- ✅ 运行时 CPU < 50%
- ✅ 没有 CPU 峰值 > 80%

---

## 🔒 安全测试用例

### 测试 11：权限隔离

**测试编号：** TC-011
**优先级：** 🟡 中

**测试步骤：**

```
1. 以 kiosk 用户登录
2. 尝试访问 C:\Windows\System32
3. 尝试修改注册表
4. 尝试安装软件
5. 尝试访问其他用户文件
```

**验证标准：**
- ✅ kiosk 用户无法访问系统目录
- ✅ kiosk 用户无法修改注册表
- ✅ kiosk 用户无法安装软件
- ✅ kiosk 用户无法访问其他用户文件

---

### 测试 12：API Key 安全

**测试编号：** TC-012
**优先级：** 🟡 中

**测试步骤：**

```
1. 打开 DevTools
2. 搜索 "sk-" 字符串
3. 检查网络请求
4. 检查本地存储
5. 检查 Cookie
```

**验证标准：**
- ✅ API Key 不在前端代码中
- ✅ API Key 不在网络请求中
- ✅ API Key 不在本地存储中
- ✅ API Key 不在 Cookie 中

---

## 📋 测试执行计划

### 第一轮：单元测试

**时间：** 开发阶段
**执行者：** 开发人员
**用例：** TC-001 ~ TC-005

```bash
# 运行单元测试
yarn test

# 生成覆盖率报告
yarn test:coverage
```

---

### 第二轮：集成测试

**时间：** 打包前
**执行者：** QA 人员
**用例：** TC-006 ~ TC-007

```bash
# 启动开发环境
yarn dev
yarn dev:backend
yarn electron:dev

# 执行集成测试
yarn test:integration
```

---

### 第三轮：功能测试

**时间：** 打包后
**执行者：** QA 人员
**用例：** TC-001 ~ TC-005

**测试环境：**
- Windows 10 虚拟机
- 触摸屏模拟器
- 网络隔离环境

---

### 第四轮：性能测试

**时间：** 部署前
**执行者：** 性能测试人员
**用例：** TC-008 ~ TC-010

**测试工具：**
- Windows 任务管理器
- Chrome DevTools
- 性能监控脚本

---

### 第五轮：安全测试

**时间：** 部署前
**执行者：** 安全人员
**用例：** TC-011 ~ TC-012

**测试工具：**
- Burp Suite
- OWASP ZAP
- 权限检查工具

---

## 📊 测试报告模板

### 测试执行报告

```
测试编号：TC-001
测试名称：开机自动登录
执行日期：2026-01-13
执行人员：张三
测试环境：Windows 10 19042

测试步骤：
1. 重启电脑
2. 观察启动过程
3. 检查登录状态

测试结果：✅ 通过

详细说明：
- 自动登录成功
- 无需输入密码
- 直接进入应用
- 启动时间 45 秒

问题记录：无

签名：张三
日期：2026-01-13
```

---

## 🐛 缺陷报告模板

### 缺陷报告

```
缺陷编号：BUG-001
缺陷标题：虚拟键盘不弹出
严重程度：🔴 高
优先级：🔴 高
报告人：李四
报告日期：2026-01-13

重现步骤：
1. 启动应用
2. 点击搜索框
3. 等待虚拟键盘

预期结果：虚拟键盘弹出

实际结果：虚拟键盘未弹出

环境信息：
- 系统：Windows 10 19042
- 应用版本：1.0.0
- 后端版本：1.0.0

日志信息：
[虚拟键盘] 方法 1: PowerShell COM 接口
[虚拟键盘] 方法 2: 尝试启动 TabTip.exe
[虚拟键盘] TabTip.exe 启动失败: ...

附件：
- 截图
- 日志文件
- 视频录制

状态：待处理
```

---

## ✅ 测试检查清单

### 功能测试检查清单

- [ ] TC-001：开机自动登录
- [ ] TC-002：虚拟键盘弹出
- [ ] TC-003：管理面板打开
- [ ] TC-004：切换用户功能
- [ ] TC-005：AI 解梦功能

### 集成测试检查清单

- [ ] TC-006：IPC 通信
- [ ] TC-007：系统命令执行

### 性能测试检查清单

- [ ] TC-008：启动时间
- [ ] TC-009：内存使用
- [ ] TC-010：CPU 使用

### 安全测试检查清单

- [ ] TC-011：权限隔离
- [ ] TC-012：API Key 安全

---

**最后更新：** 2026-01-13
**版本：** 1.0
**状态：** ✅ 完成
