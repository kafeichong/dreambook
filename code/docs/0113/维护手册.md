# DreamBook Kiosk 维护手册

> 日常维护、常见操作和应急处理指南

---

## 📋 日常维护任务

### 每日检查

**时间：** 每天上班时
**耗时：** 5 分钟

```cmd
# 1. 检查应用是否正常运行
tasklist | findstr dreambook

# 2. 检查后端服务是否运行
netstat -ano | findstr :3000

# 3. 查看最新日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" -Tail 20

# 4. 检查磁盘空间
Get-Volume C: | Select-Object SizeRemaining
```

**预期结果：**
- ✅ dreambook.exe 进程运行中
- ✅ 端口 3000 监听中
- ✅ 日志无错误信息
- ✅ 磁盘空间 > 1GB

---

### 每周维护

**时间：** 每周一上午
**耗时：** 30 分钟

```cmd
# 1. 清理旧日志（保留 7 天）
Get-ChildItem "$env:USERPROFILE\dreambook-logs\app-*.log" |
  Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-7)} |
  Remove-Item

# 2. 检查磁盘使用
Get-ChildItem "C:\kiosk\dreambook" -Recurse |
  Measure-Object -Property Length -Sum |
  Select-Object @{Name="Size(MB)";Expression={[math]::Round($_.Sum/1MB,2)}}

# 3. 验证系统配置
.\verify-kiosk.bat

# 4. 检查更新
# 访问 GitHub 检查是否有新版本
```

**预期结果：**
- ✅ 旧日志已清理
- ✅ 应用大小 < 500MB
- ✅ 所有配置验证通过
- ✅ 无新版本或已更新

---

### 每月维护

**时间：** 每月第一个工作日
**耗时：** 1 小时

```cmd
# 1. 备份应用和配置
$BackupPath = "D:\backup\dreambook-$(Get-Date -Format 'yyyy-MM-dd')"
Copy-Item "C:\kiosk\dreambook" -Destination $BackupPath -Recurse

# 2. 备份日志
Copy-Item "$env:USERPROFILE\dreambook-logs" -Destination "$BackupPath\logs" -Recurse

# 3. 检查系统更新
# 检查 Windows 更新
# 检查驱动程序更新

# 4. 性能分析
# 检查应用内存使用趋势
# 检查 CPU 使用趋势

# 5. 安全检查
# 检查防火墙规则
# 检查用户权限
```

**预期结果：**
- ✅ 备份完成
- ✅ 系统更新检查完成
- ✅ 性能指标正常
- ✅ 安全配置正确

---

### 每季度维护

**时间：** 每季度第一个工作日
**耗时：** 2 小时

```cmd
# 1. 完整系统检查
.\verify-kiosk.bat

# 2. 应用更新检查
# 检查是否有新版本
# 如果有，进行更新测试

# 3. 性能基准测试
# 记录启动时间
# 记录内存使用
# 记录 CPU 使用

# 4. 安全审计
# 检查日志中的异常
# 检查用户权限
# 检查防火墙规则

# 5. 文档更新
# 更新维护日志
# 更新故障排查指南
```

---

## 🔧 常见操作

### 操作 1：更新应用

**场景：** 发布了新版本，需要更新应用

**步骤：**

```cmd
# 1. 以管理员身份打开 PowerShell

# 2. 停止应用
taskkill /IM dreambook.exe /F

# 3. 备份旧版本
Copy-Item "C:\kiosk\dreambook\dreambook.exe" -Destination "C:\kiosk\dreambook\dreambook.exe.bak"

# 4. 复制新版本
Copy-Item -Path "D:\downloads\dreambook.exe" -Destination "C:\kiosk\dreambook\dreambook.exe" -Force

# 5. 验证文件
dir C:\kiosk\dreambook\dreambook.exe

# 6. 启动应用
C:\kiosk\dreambook\dreambook.exe

# 7. 测试功能
# 点击输入框测试虚拟键盘
# 右上角点击 5 次测试管理面板
# 测试 AI 解梦功能
```

**验证：**
- ✅ 应用启动成功
- ✅ 所有功能正常
- ✅ 没有错误日志

**回滚：**
```cmd
# 如果新版本有问题，恢复旧版本
taskkill /IM dreambook.exe /F
Copy-Item "C:\kiosk\dreambook\dreambook.exe.bak" -Destination "C:\kiosk\dreambook\dreambook.exe" -Force
C:\kiosk\dreambook\dreambook.exe
```

---

### 操作 2：重启应用

**场景：** 应用卡死或需要重启

**步骤：**

```cmd
# 方法 1：通过管理面板重启
# 1. 右上角点击 5 次打开管理面板
# 2. 点击"重启应用"
# 3. 应用自动重启

# 方法 2：通过命令行重启
taskkill /IM dreambook.exe /F
C:\kiosk\dreambook\dreambook.exe

# 方法 3：通过任务计划程序重启
# 1. 打开任务计划程序
# 2. 找到 DreamBook 任务
# 3. 点击"运行"
```

---

### 操作 3：查看日志

**场景：** 需要诊断问题

**步骤：**

```cmd
# 查看最新日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" -Tail 100

# 搜索特定错误
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" | Select-String "错误"

# 搜索虚拟键盘相关日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" | Select-String "虚拟键盘"

# 实时查看日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" -Wait

# 导出日志到文件
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" | Out-File "C:\Temp\dreambook-logs.txt"
```

---

### 操作 4：清理缓存

**场景：** 应用运行缓慢或占用空间过大

**步骤：**

```cmd
# 1. 停止应用
taskkill /IM dreambook.exe /F

# 2. 清理缓存目录
Remove-Item "$env:APPDATA\dreambook" -Recurse -Force

# 3. 清理旧日志
Get-ChildItem "$env:USERPROFILE\dreambook-logs\app-*.log" |
  Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-30)} |
  Remove-Item

# 4. 清理临时文件
Remove-Item "$env:TEMP\dreambook*" -Recurse -Force

# 5. 启动应用
C:\kiosk\dreambook\dreambook.exe
```

---

### 操作 5：切换用户进行维护

**场景：** 需要以 Administrator 身份进行系统维护

**步骤：**

```cmd
# 方法 1：通过管理面板切换
# 1. 右上角点击 5 次打开管理面板
# 2. 点击"切换用户"
# 3. 进入 Windows 登录界面
# 4. 登录 Administrator 账户

# 方法 2：通过命令行切换
C:\Windows\System32\tsdiscon.exe

# 方法 3：通过任务管理器切换
# 1. Ctrl+Shift+Esc 打开任务管理器
# 2. 找到 dreambook.exe
# 3. 右键 → 结束任务
# 4. 按 Ctrl+Alt+Delete
# 5. 点击"切换用户"
```

---

## 🚨 应急处理

### 应急 1：应用无法启动

**症状：** 点击应用图标无反应

**快速诊断：**

```cmd
# 1. 检查进程
tasklist | findstr dreambook

# 2. 查看最新日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" -Tail 50

# 3. 检查文件完整性
dir C:\kiosk\dreambook\dreambook.exe
```

**快速修复：**

```cmd
# 1. 强制关闭所有 dreambook 进程
taskkill /IM dreambook.exe /F

# 2. 清理缓存
Remove-Item "$env:APPDATA\dreambook" -Recurse -Force

# 3. 重新启动应用
C:\kiosk\dreambook\dreambook.exe

# 4. 如果还是不行，恢复备份
Copy-Item "C:\kiosk\dreambook\dreambook.exe.bak" -Destination "C:\kiosk\dreambook\dreambook.exe" -Force
C:\kiosk\dreambook\dreambook.exe
```

---

### 应急 2：虚拟键盘不工作

**症状：** 点击输入框虚拟键盘不弹出

**快速诊断：**

```cmd
# 1. 检查服务状态
sc query TabletInputService

# 2. 手动测试虚拟键盘
"C:\Program Files\Common Files\microsoft shared\ink\TabTip.exe"

# 3. 查看日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" | Select-String "虚拟键盘"
```

**快速修复：**

```cmd
# 1. 重启虚拟键盘服务
sc stop TabletInputService
sc start TabletInputService

# 2. 重启应用
taskkill /IM dreambook.exe /F
C:\kiosk\dreambook\dreambook.exe

# 3. 如果还是不行，重启电脑
Restart-Computer
```

---

### 应急 3：应用卡死

**症状：** 应用界面冻结，无法点击任何按钮

**快速诊断：**

```cmd
# 1. 检查进程状态
Get-Process dreambook

# 2. 检查内存使用
Get-Process dreambook | Select-Object WorkingSet

# 3. 查看日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" -Tail 50
```

**快速修复：**

```cmd
# 1. 强制关闭应用
taskkill /IM dreambook.exe /F

# 2. 等待 5 秒
Start-Sleep -Seconds 5

# 3. 重新启动应用
C:\kiosk\dreambook\dreambook.exe

# 4. 如果频繁卡死，检查系统资源
Get-WmiObject Win32_OperatingSystem | Select-Object FreePhysicalMemory, TotalVisibleMemorySize
```

---

### 应急 4：后端服务不响应

**症状：** AI 解梦功能无法使用，显示"服务暂时不可用"

**快速诊断：**

```cmd
# 1. 检查端口
netstat -ano | findstr :3000

# 2. 测试后端健康检查
curl http://localhost:3000/health

# 3. 查看日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" | Select-String "后端"
```

**快速修复：**

```cmd
# 1. 重启应用（会自动重启后端）
taskkill /IM dreambook.exe /F
C:\kiosk\dreambook\dreambook.exe

# 2. 如果端口被占用，释放端口
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# 3. 重启电脑
Restart-Computer
```

---

## 📊 维护日志模板

### 日常检查日志

```
日期：2026-01-13
检查人：张三
检查时间：09:00

检查项目：
□ 应用进程运行中
□ 后端服务运行中
□ 日志无错误
□ 磁盘空间充足

检查结果：✅ 正常

备注：无异常

签名：张三
```

---

### 维护操作日志

```
日期：2026-01-13
操作人：李四
操作时间：14:00
操作类型：应用更新

操作步骤：
1. 停止应用
2. 备份旧版本
3. 复制新版本
4. 启动应用
5. 测试功能

操作结果：✅ 成功

新版本：1.0.1
旧版本：1.0.0

测试结果：
- 虚拟键盘：✅ 正常
- 管理面板：✅ 正常
- AI 解梦：✅ 正常

备注：无问题

签名：李四
```

---

### 故障处理日志

```
日期：2026-01-13
报告人：王五
故障时间：10:30
故障类型：应用卡死

故障描述：
应用界面冻结，无法点击任何按钮

处理步骤：
1. 强制关闭应用
2. 清理缓存
3. 重新启动应用
4. 测试功能

处理结果：✅ 解决

根本原因：内存泄漏

预防措施：
- 增加内存监控
- 定期重启应用

签名：王五
```

---

## 📞 联系方式

### 技术支持

| 类型 | 联系方式 | 响应时间 |
|------|---------|---------|
| 紧急故障 | 电话：xxx-xxxx-xxxx | 15 分钟 |
| 一般问题 | 邮件：support@example.com | 1 小时 |
| 功能建议 | 论坛：forum.example.com | 1 天 |

### 常用命令速查

```cmd
# 查看应用进程
tasklist | findstr dreambook

# 查看后端服务
netstat -ano | findstr :3000

# 查看日志
Get-Content "$env:USERPROFILE\dreambook-logs\app-*.log" -Tail 100

# 重启应用
taskkill /IM dreambook.exe /F && C:\kiosk\dreambook\dreambook.exe

# 重启虚拟键盘服务
sc stop TabletInputService && sc start TabletInputService

# 重启电脑
Restart-Computer

# 清理缓存
Remove-Item "$env:APPDATA\dreambook" -Recurse -Force

# 备份应用
Copy-Item "C:\kiosk\dreambook" -Destination "D:\backup\dreambook-$(Get-Date -Format 'yyyy-MM-dd')" -Recurse
```

---

**最后更新：** 2026-01-13
**版本：** 1.0
**状态：** ✅ 完成
