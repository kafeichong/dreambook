# DreamBook 子路径配置
# 添加到现有 Nginx 的 server 块中

# 如果你的 emotion-library 配置在 /etc/nginx/conf.d/emotion-library.conf
# 则在该文件的 server 块中添加以下内容：

# ============ DreamBook 子路径部署 ============

# 前端静态文件
location /dreambook {
    alias /usr/share/nginx/html/dreambook;
    index index.html;

    # SPA 路由支持（重要！）
    try_files $uri $uri/ /dreambook/index.html;

    # 缓存策略
    expires 1h;
    add_header Cache-Control "public, max-age=3600";
}

# 静态资源
location ~ ^/dreambook/.*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$ {
    alias /usr/share/nginx/html/dreambook;
    expires 7d;
    add_header Cache-Control "public, max-age=604800, immutable";
}

# DreamBook API 代理
location /dreambook/api/ {
    # 去掉 /dreambook 前缀
    rewrite ^/dreambook/api/(.*) /api/$1 break;

    proxy_pass http://host.docker.internal:3001;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}

# DreamBook 健康检查
location /dreambook/health {
    proxy_pass http://host.docker.internal:3001/health;
    access_log off;
}

# ============ DreamBook 配置结束 ============
